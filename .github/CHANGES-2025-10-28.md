# Changes (2025-10-28)

Summary of key changes made on 2025-10-28. These edits improve the image grid layout, UX for filters/settings, and persist UI preferences.

## Major functional changes

- Image grid: replaced Masonry with a justified-row layout so images in the same row share a uniform height and widths scale proportionally. This prevents rows from being broken by tall images and makes layout calculations deterministic. (file: `src/components/ImageGrid.tsx`)

- Grouping: images are now grouped by time (day/week/month) and each group renders its label once above the group's block. Groups are computed before layout so images from different time groups do not mix in the same row. (`src/components/ImageGrid.tsx`)

- Picture overlay: file name and modified date are hidden by default; they appear on hover as a semi-transparent overlay to improve the browsing experience. (`src/components/ImageGrid.tsx`)

- FilterChips: when there are many data sources, chips are capped to a visible set and the remainder moves into a "More" menu to avoid layout overflow. (`src/components/FilterChips.tsx`)

- AppBar auto-hide: the top bar (title/search/settings) auto-hides when scrolling down and shows when scrolling up, using a slide animation. (`src/App.tsx`)

- Search fix: searching in the "All Sources" view now filters client-side Dexie queries correctly. (`src/components/ImageGrid.tsx`)

- Settings and persistence:
  - `SettingsDialog` now exposes controls for `rowHeight`, `gap`, and `groupBy` (day/week/month).
  - Settings are persisted into a new Dexie `settings` table (`src/db/db.ts`) and loaded on app start. (`src/App.tsx`, `src/components/SettingsDialog.tsx`)
  - Instant preview and a short "Settings saved" snackbar are shown when editing settings.

## Files changed / added

- Modified: `src/components/ImageGrid.tsx` (justified-row layout, grouping, hover overlay, props: rowHeight/gap/groupBy, search fix)
- Modified: `src/components/FilterChips.tsx` (more menu + hooks order fix)
- Modified: `src/App.tsx` (app bar auto-hide, pass gridSettings, persist settings in Dexie)
- Modified: `src/components/SettingsDialog.tsx` (grid controls, reset button, snackbar)
- Modified: `src/db/db.ts` (add `settings` table)
- Modified: `src/locales/en.json`, `src/locales/zh.json` (i18n texts for new settings and reset/saved labels)
- Added: `.github/CHANGES-2025-10-28.md` (this file)

## How to test locally

1. Start backend proxy and dev server (PowerShell):

```powershell
node server.cjs
npm run dev
```

2. Open http://localhost:5173
3. Verify grid behavior:
   - Scroll the page and ensure the AppBar hides on scroll-down and shows on scroll-up.
   - In Settings, change Row height / Gap / Group by and observe immediate layout update and a short "Settings saved" snackbar.
   - Confirm the settings persist after page reload (stored in IndexedDB -> `settings` table).
   - In "All Sources" view, run a search and confirm results include matching client-side items.

## Notes & follow-ups

- Consider moving gridSettings into Redux if multiple components need to read them globally.
- The week grouping uses a simple ISO week approximation; replace with a robust library (date-fns) if exact ISO week handling is required.
- Performance: for extremely large number of images, consider virtualizing rows or computing layout incrementally to reduce initial CPU cost.

If you want, I can: persist settings in Redux, add an "Undo" to Snackbar, or extract the layout algorithm into a reusable hook with unit tests.
